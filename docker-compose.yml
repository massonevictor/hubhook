version: "3.8"

x-stack-env: &stack-env
  - stack.env

services:
  server:
    build:
      context: .
      dockerfile: Dockerfile.server
      args:
        DATABASE_URL: ${DATABASE_URL:-postgresql://appuser4r3:9wg4hw948gha048gh@postgres-db:5432/appdb134}
    env_file: *stack-env
    ports:
      - "4000:4000"
    networks:
      - proxy

  web:
    build:
      context: .
      dockerfile: Dockerfile.web
      args:
        VITE_API_URL: ${VITE_API_URL:-http://server:4000}
    env_file: *stack-env
    ports:
      - "5173:80"
    networks:
      - proxy

networks:
  proxy:
    external: true
